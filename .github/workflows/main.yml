# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the action will run.
on:
  # Triggers the workflow on push or pull request events but only for the main branch
  push:
    branches: [main]
  pull_request:
    branches: [main]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - name: confirm
        run: ls -la /home/runner/work/php-makeobj-wrapper/php-makeobj-wrapper/tests/../bin/makeobj-linux-60-2/

      - name: chmod
        run: chmod -R 777 ./
      - name: install makeobj dependencies
        run: sudo cp ./bin/libpng12.so.0 /lib/x86_64-linux-gnu/ && sudo chmod 777 /lib/x86_64-linux-gnu/libpng12.so.0
        # ln -s `find /usr/lib64/ -type f -name "libbz2.so.1*"` /usr/lib64/libbz2.so.1.0
        # run: wget -q -O /tmp/libpng12.deb http://mirrors.kernel.org/ubuntu/pool/main/libp/libpng/libpng12-0_1.2.54-1ubuntu1_amd64.deb && sudo dpkg -i /tmp/libpng12.deb && rm /tmp/libpng12.deb
        # run: sudo apt install -y libpng-dev
      - name: check makeobj dependencies
        run: ldd ./bin/makeobj-linux-60-2/makeobj
      - name: check makeobj
        run: ./bin/makeobj-linux-60-2/makeobj CAPABILITIES

      - name: PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: "8"

      # Runs a set of commands using the runners shell
      - name: Run a multi-line script
        run: |
          echo Add other actions to build,
          echo test, and deploy your project.
      - name: Composer Install
        run: composer install
      - name: Test
        run: sudo ./vendor/bin/phpunit -c phpunit.linux.xml -v
